<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Vapor Documentation</title>

        <link rel="stylesheet"  href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
        <link rel="stylesheet"  href="https://fonts.googleapis.com/css?family=Quicksand:400,700,300">
        <link rel="stylesheet" href="https://vapor.github.io/documentation/styles/qutheory-code.css">
        <link rel="stylesheet" href="https://vapor.github.io/documentation/styles/main.css">
    </head>
    <body>

        <header>
            <a class="logo" href="https://vapor.github.io/documentation/">
                <img src="https://vapor.github.io/documentation/images/droplet.svg" alt="Vapor">
                <h1>Vapor <em>Docs</em></h1>
            </a>
            <ul>
                <li>
                    <a href="http://qutheory.io">Home</a>
                </li>
                <li>
                    <a href="http://example.qutheory.io">Example</a>
                </li>
                <li>
                    <a href="https://github.com/qutheory/vapor">GitHub</a>
                </li>
                <li>
                    <a href="https://twitter.com/@qutheory">Twitter</a>
                </li>
                <li>
                    <a href="http://slack.qutheory.io">Slack</a>
                </li>
            </ul>
        </header>

        <nav>
            <div class="scroll">
                            <section>
                    <h3>Getting Started</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-swift-3-macos.html">
                                Install Swift 3: macOS
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-swift-3-ubuntu.html">
                                Install Swift 3: Ubuntu
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-swift-3.html">
                                Install Swift 3
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/quickstart.html">
                                Manual QuickStart
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-toolbox.html">
                                Install Toolbox
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/hello-world.html">
                                Hello, World
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/xcode.html">
                                Xcode
                            </a>
                        </li>
                                        </ul>
                </section>
                            <section>
                    <h3>Guide</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/droplet.html">
                                Droplet
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/folder-structure.html">
                                Folder Structure
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/json.html">
                                JSON
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/config.html">
                                Config
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/views.html">
                                Views
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/middleware.html">
                                Middleware
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/validation.html">
                                Validation
                            </a>
                        </li>
                                        </ul>
                </section>
                            <section>
                    <h3>Routing</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/basic.html">
                                Basic
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/parameters.html">
                                Parameters
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/group.html">
                                Group
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/collection.html">
                                Collection
                            </a>
                        </li>
                                        </ul>
                </section>
                            <section>
                    <h3>HTTP</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/request.html">
                                Request
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/response.html">
                                Response
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/body.html">
                                Body
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/response-representable.html">
                                ResponseRepresentable
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/responder.html">
                                Responder
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/client.html">
                                Client
                            </a>
                        </li>
                                        </ul>
                </section>
                        </div>
        </nav>

        <main>
            <a href="https://github.com/qutheory/documentation/blob/master/CONTRIBUTING.md" class="edit">âœŽ Edit on GitHub</a>
            <blockquote>
<p>Module: <code>import HTTP</code></p>
</blockquote>
<h1 id="body">Body</h1>
<p>The <code>HTTP.Body</code> represents the payload of an <code>HTTP.Message</code>, and is used to pass the underlying data. Some examples of this in practice would be <code>JSON</code>, <code>HTML</code> text, or the bytes of an image. Let's look at the implementation:</p>
<pre><code class="language-swift">public enum Body {
    case data(Bytes)
    case chunked((ChunkStream) throws -&gt; Void)
}</code></pre>
<h2 id="data-case">Data Case</h2>
<p>The <code>data</code> case is by far the most common use for a <code>Body</code> in an <code>HTTP.Message</code>. It is simply an array of bytes. The serialization protocol or type associated with these bytes is usually defined by the <code>Content-Type</code> header. Let's look at some examples.</p>
<h3 id="applicationjson">Application/JSON</h3>
<p>If our <code>Content-Type</code> header contains <code>application/json</code>, then the underlying bytes represent serialized JSON.</p>
<pre><code class="language-swift">if let contentType = req.headers["Content-Type"], contentType.contains("application/json"), let bytes = req.body.bytes {
  let json = try JSON(bytes: bytes)
  print("Got JSON: \(json)")
}</code></pre>
<h3 id="imagepng">Image/PNG</h3>
<p>If our <code>Content-Type</code> contains <code>image/png</code>, then the underlying bytes represent an encoded png.</p>
<pre><code class="language-swift">if let contentType = req.headers["Content-Type"], contentType.contains("image/png"), let bytes = req.body.bytes {
  try database.save(image: bytes)
}</code></pre>
<h2 id="chunked-case">Chunked Case</h2>
<p>The <code>chunked</code> case only applies to outgoing <code>HTTP.Message</code>s in Vapor. It is traditionally a responder's role to collect an entire chunked encoding before passing it on. We can use this to send a body asynchronously.</p>
<pre><code class="language-swift">let body: Body = Body.chunked(sender)
return Response(status: .ok, body: body)</code></pre>
<p>We can implement this manually, or use Vapor's built in convenience initializer for chunked bodies:</p>
<pre><code class="language-swift">return Response(status: .ok) { chunker in
  for name in ["joe", "pam", "cheryl"] {
      sleep(1)
      try chunker.send(name)
  }

  try chunker.close()
}</code></pre>
<blockquote>
<p>Make sure to call <code>close()</code> before the chunker leaves scope.</p>
</blockquote>
<h2 id="bodyrepresentable">BodyRepresentable</h2>
<p>In addition to the concrete <code>Body</code> type, as is common in Vapor, we also have wide support for <code>BodyRepresentable</code>. This means objects that we're commonly converting to <code>Body</code> type can be used interchangeably. For example:</p>
<pre><code class="language-swift">return Response(body: "Hello, World!")</code></pre>
<p>In the above example, string is converted to bytes and added to the body.</p>
<blockquote>
<p>In practice, it is better to use <code>return "Hello, World!"</code>. Vapor will automatically be able to set the <code>Content-Type</code> to appropriate values.</p>
</blockquote>
<p>Let's look at how it's implemented:</p>
<pre><code class="language-swift">public protocol BodyRepresentable {
    func makeBody() -&gt; Body
}</code></pre>
<h3 id="custom">Custom</h3>
<p>We can conform our own types to this as well where applicable. Let's pretend we have a custom data type, <code>.vpr</code>. Let's conform our <code>VPR</code> file type model:</p>
<pre><code class="language-swift">extension VPRFile: HTTP.BodyRepresentable {
  func makeBody() -&gt; Body {
    // collect bytes
    return .data(bytes)
  }
}</code></pre>
<blockquote>
<p>You may have noticed above, that the protocol throws, but our implementation does not. This is compeletely valid in Swift and will allow you to not throw if you're ever calling the function manually.</p>
</blockquote>
<p>Now we're able to include our <code>VPR</code> file directly in our <code>Responses</code>.</p>
<pre><code class="language-swift">drop.get("files", ":file-name") { request in
  let filename = try request.parameters.extract("file-name") as String
  let file = VPRFileManager.fetch(filename)
  return Response(status: .ok, headers: ["Content-Type": "file/vpr"], body: file)
}</code></pre>
<p>In practice, if we're repeating this often, we'll probably conform <code>VPRFile</code> directly to <code>ResponseRepresentable</code></p>
<pre><code class="language-swift">extension VPRFile: HTTP.ResponseRepresentable {
  func makeResponse() -&gt; Response {
    return Response(
      status: .ok,
      headers: ["Content-Type": "file/vpr"],
      body: file
    )
  }
}</code></pre>
<p>Here's our above example now:</p>
<pre><code class="language-swift">drop.get("files", ":file-name") { request in
  let filename = try request.parameters.extract("file-name") as String
  return VPRFileManager.fetch(filename)
}</code></pre>
<p>We could also use type-safe routing to make this even more concise:</p>
<pre><code class="language-swift">drop.get("files", String.self) { request, filename in
  return VPRFileManager.fetch(filename)
}</code></pre>
        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="https://vapor.github.io/documentation/scripts/highlight.pack.js"></script>

        <script>
            $(function() {
                // Syntax highlighting
                hljs.initHighlightingOnLoad();

                if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {
                    $('body').addClass('safari');
                }
            });
        </script>

    </body>
</html>
